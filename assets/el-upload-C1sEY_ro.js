import{aA as Q,D as ue,G as A,H as m,aP as k,d as U,L as ke,M as q,i as de,f as G,o as b,n as S,w as P,F as Ee,e as s,U as y,a8 as ce,c as w,g as h,V as D,W as O,bP as $e,a as F,t as Z,b as N,v as Ce,bQ as Re,bR as Pe,bz as _e,bS as Le,bT as Fe,Y as R,p as we,aH as Se,_ as M,N as Ue,aK as X,bU as x,bV as Te,$ as Oe,bW as De,O as ee,P as Be,aB as je,T as Ne,ab as qe,bo as te,Z as se,am as Ae}from"./index-wO-3NrcT.js";import{E as Me}from"./el-progress-qPneQqir.js";import{i as fe}from"./constants-AiZ5uBDr.js";import{m as Y}from"./typescript-WBLZcIum.js";import{b as H}from"./use-form-item-rVX41obl.js";import{b as He}from"./_baseClone-wOQFNS6D.js";import{i as Ke}from"./isEqual-mX3RYyuw.js";var ze=1,Ve=4;function ae(o){return He(o,ze|Ve)}const pe=Symbol("uploadContextKey"),Ie="ElUpload";class We extends Error{constructor(r,e,f,u){super(r),this.name="UploadAjaxError",this.status=e,this.method=f,this.url=u}}function oe(o,r,e){let f;return e.response?f=`${e.response.error||e.response}`:e.responseText?f=`${e.responseText}`:f=`fail to ${r.method} ${o} ${e.status}`,new We(f,e.status,r.method,o)}function Ge(o){const r=o.responseText||o.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Xe=o=>{typeof XMLHttpRequest>"u"&&Q(Ie,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,e=o.action;r.upload&&r.upload.addEventListener("progress",d=>{const v=d;v.percent=d.total>0?d.loaded/d.total*100:0,o.onProgress(v)});const f=new FormData;if(o.data)for(const[d,v]of Object.entries(o.data))ue(v)&&v.length?f.append(d,...v):f.append(d,v);f.append(o.filename,o.file,o.file.name),r.addEventListener("error",()=>{o.onError(oe(e,o,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return o.onError(oe(e,o,r));o.onSuccess(Ge(r))}),r.open(o.method,e,!0),o.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const u=o.headers||{};if(u instanceof Headers)u.forEach((d,v)=>r.setRequestHeader(v,d));else for(const[d,v]of Object.entries(u))fe(v)||r.setRequestHeader(d,String(v));return r.send(f),r},ve=["text","picture","picture-card"];let Ye=1;const J=()=>Date.now()+Ye++,me=A({action:{type:String,default:"#"},headers:{type:m(Object)},method:{type:String,default:"post"},data:{type:m([Object,Function,Promise]),default:()=>Y({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:m(Array),default:()=>Y([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:m(Function),default:Xe},disabled:Boolean,limit:Number}),Je=A({...me,beforeUpload:{type:m(Function),default:k},beforeRemove:{type:m(Function)},onRemove:{type:m(Function),default:k},onChange:{type:m(Function),default:k},onPreview:{type:m(Function),default:k},onSuccess:{type:m(Function),default:k},onProgress:{type:m(Function),default:k},onError:{type:m(Function),default:k},onExceed:{type:m(Function),default:k}}),Qe=A({files:{type:m(Array),default:()=>Y([])},disabled:{type:Boolean,default:!1},handlePreview:{type:m(Function),default:k},listType:{type:String,values:ve,default:"text"}}),Ze={remove:o=>!!o},xe=["onKeydown"],et=["src"],tt=["onClick"],st=["title"],at=["onClick"],ot=["onClick"],nt=U({name:"ElUploadList"}),lt=U({...nt,props:Qe,emits:Ze,setup(o,{emit:r}){const e=o,{t:f}=ke(),u=q("upload"),d=q("icon"),v=q("list"),C=H(),g=de(!1),E=G(()=>[u.b("list"),u.bm("list",e.listType),u.is("disabled",e.disabled)]),$=p=>{r("remove",p)};return(p,n)=>(b(),S(Se,{tag:"ul",class:y(s(E)),name:s(v).b()},{default:P(()=>[(b(!0),w(Ee,null,we(p.files,t=>(b(),w("li",{key:t.uid||t.name,class:y([s(u).be("list","item"),s(u).is(t.status),{focusing:g.value}]),tabindex:"0",onKeydown:ce(i=>!s(C)&&$(t),["delete"]),onFocus:n[0]||(n[0]=i=>g.value=!0),onBlur:n[1]||(n[1]=i=>g.value=!1),onClick:n[2]||(n[2]=i=>g.value=!1)},[R(p.$slots,"default",{file:t},()=>[p.listType==="picture"||t.status!=="uploading"&&p.listType==="picture-card"?(b(),w("img",{key:0,class:y(s(u).be("list","item-thumbnail")),src:t.url,alt:""},null,10,et)):h("v-if",!0),t.status==="uploading"||p.listType!=="picture-card"?(b(),w("div",{key:1,class:y(s(u).be("list","item-info"))},[N("a",{class:y(s(u).be("list","item-name")),onClick:D(i=>p.handlePreview(t),["prevent"])},[F(s(O),{class:y(s(d).m("document"))},{default:P(()=>[F(s($e))]),_:1},8,["class"]),N("span",{class:y(s(u).be("list","item-file-name")),title:t.name},Z(t.name),11,st)],10,tt),t.status==="uploading"?(b(),S(s(Me),{key:0,type:p.listType==="picture-card"?"circle":"line","stroke-width":p.listType==="picture-card"?6:2,percentage:Number(t.percentage),style:Ce(p.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):h("v-if",!0)],2)):h("v-if",!0),N("label",{class:y(s(u).be("list","item-status-label"))},[p.listType==="text"?(b(),S(s(O),{key:0,class:y([s(d).m("upload-success"),s(d).m("circle-check")])},{default:P(()=>[F(s(Re))]),_:1},8,["class"])):["picture-card","picture"].includes(p.listType)?(b(),S(s(O),{key:1,class:y([s(d).m("upload-success"),s(d).m("check")])},{default:P(()=>[F(s(Pe))]),_:1},8,["class"])):h("v-if",!0)],2),s(C)?h("v-if",!0):(b(),S(s(O),{key:2,class:y(s(d).m("close")),onClick:i=>$(t)},{default:P(()=>[F(s(_e))]),_:2},1032,["class","onClick"])),h(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),h(" This is a bug which needs to be fixed "),h(" TODO: Fix the incorrect navigation interaction "),s(C)?h("v-if",!0):(b(),w("i",{key:3,class:y(s(d).m("close-tip"))},Z(s(f)("el.upload.deleteTip")),3)),p.listType==="picture-card"?(b(),w("span",{key:4,class:y(s(u).be("list","item-actions"))},[N("span",{class:y(s(u).be("list","item-preview")),onClick:i=>p.handlePreview(t)},[F(s(O),{class:y(s(d).m("zoom-in"))},{default:P(()=>[F(s(Le))]),_:1},8,["class"])],10,at),s(C)?h("v-if",!0):(b(),w("span",{key:0,class:y(s(u).be("list","item-delete")),onClick:i=>$(t)},[F(s(O),{class:y(s(d).m("delete"))},{default:P(()=>[F(s(Fe))]),_:1},8,["class"])],10,ot))],2)):h("v-if",!0)])],42,xe))),128)),R(p.$slots,"append")]),_:3},8,["class","name"]))}});var ne=M(lt,[["__file","upload-list.vue"]]);const rt=A({disabled:{type:Boolean,default:!1}}),it={file:o=>ue(o)},ut=["onDrop","onDragover"],ye="ElUploadDrag",dt=U({name:ye}),ct=U({...dt,props:rt,emits:it,setup(o,{emit:r}){const e=Ue(pe);e||Q(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const f=q("upload"),u=de(!1),d=H(),v=g=>{if(d.value)return;u.value=!1,g.stopPropagation();const E=Array.from(g.dataTransfer.files),$=e.accept.value;if(!$){r("file",E);return}const p=E.filter(n=>{const{type:t,name:i}=n,a=i.includes(".")?`.${i.split(".").pop()}`:"",c=t.replace(/\/.*$/,"");return $.split(",").map(l=>l.trim()).filter(l=>l).some(l=>l.startsWith(".")?a===l:/\/\*$/.test(l)?c===l.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(l)?t===l:!1)});r("file",p)},C=()=>{d.value||(u.value=!0)};return(g,E)=>(b(),w("div",{class:y([s(f).b("dragger"),s(f).is("dragover",u.value)]),onDrop:D(v,["prevent"]),onDragover:D(C,["prevent"]),onDragleave:E[0]||(E[0]=D($=>u.value=!1,["prevent"]))},[R(g.$slots,"default")],42,ut))}});var ft=M(ct,[["__file","upload-dragger.vue"]]);const pt=A({...me,beforeUpload:{type:m(Function),default:k},onRemove:{type:m(Function),default:k},onStart:{type:m(Function),default:k},onSuccess:{type:m(Function),default:k},onProgress:{type:m(Function),default:k},onError:{type:m(Function),default:k},onExceed:{type:m(Function),default:k}}),vt=["onKeydown"],mt=["name","multiple","accept"],yt=U({name:"ElUploadContent",inheritAttrs:!1}),gt=U({...yt,props:pt,setup(o,{expose:r}){const e=o,f=q("upload"),u=H(),d=X({}),v=X(),C=a=>{if(a.length===0)return;const{autoUpload:c,limit:l,fileList:_,multiple:L,onStart:B,onExceed:K}=e;if(l&&_.length+a.length>l){K(a,_);return}L||(a=a.slice(0,1));for(const z of a){const j=z;j.uid=J(),B(j),c&&g(j)}},g=async a=>{if(v.value.value="",!e.beforeUpload)return $(a);let c,l={};try{const L=e.data,B=e.beforeUpload(a);l=x(e.data)?ae(e.data):e.data,c=await B,x(e.data)&&Ke(L,l)&&(l=ae(e.data))}catch{c=!1}if(c===!1){e.onRemove(a);return}let _=a;c instanceof Blob&&(c instanceof File?_=c:_=new File([c],a.name,{type:a.type})),$(Object.assign(_,{uid:a.uid}),l)},E=async(a,c)=>Oe(a)?a(c):a,$=async(a,c)=>{const{headers:l,data:_,method:L,withCredentials:B,name:K,action:z,onProgress:j,onSuccess:ge,onError:be,httpRequest:he}=e;try{c=await E(c??_,a)}catch{e.onRemove(a);return}const{uid:V}=a,I={headers:l||{},withCredentials:B,file:a,data:c,method:L,filename:K,action:z,onProgress:T=>{j(T,a)},onSuccess:T=>{ge(T,a),delete d.value[V]},onError:T=>{be(T,a),delete d.value[V]}},W=he(I);d.value[V]=W,W instanceof Promise&&W.then(I.onSuccess,I.onError)},p=a=>{const c=a.target.files;c&&C(Array.from(c))},n=()=>{u.value||(v.value.value="",v.value.click())},t=()=>{n()};return r({abort:a=>{Te(d.value).filter(a?([l])=>String(a.uid)===l:()=>!0).forEach(([l,_])=>{_ instanceof XMLHttpRequest&&_.abort(),delete d.value[l]})},upload:g}),(a,c)=>(b(),w("div",{class:y([s(f).b(),s(f).m(a.listType),s(f).is("drag",a.drag)]),tabindex:"0",onClick:n,onKeydown:ce(D(t,["self"]),["enter","space"])},[a.drag?(b(),S(ft,{key:0,disabled:s(u),onFile:C},{default:P(()=>[R(a.$slots,"default")]),_:3},8,["disabled"])):R(a.$slots,"default",{key:1}),N("input",{ref_key:"inputRef",ref:v,class:y(s(f).e("input")),name:a.name,multiple:a.multiple,accept:a.accept,type:"file",onChange:p,onClick:c[0]||(c[0]=D(()=>{},["stop"]))},null,42,mt)],42,vt))}});var le=M(gt,[["__file","upload-content.vue"]]);const re="ElUpload",ie=o=>{var r;(r=o.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(o.url)},bt=(o,r)=>{const e=De(o,"fileList",void 0,{passive:!0}),f=n=>e.value.find(t=>t.uid===n.uid);function u(n){var t;(t=r.value)==null||t.abort(n)}function d(n=["ready","uploading","success","fail"]){e.value=e.value.filter(t=>!n.includes(t.status))}const v=(n,t)=>{const i=f(t);i&&(console.error(n),i.status="fail",e.value.splice(e.value.indexOf(i),1),o.onError(n,i,e.value),o.onChange(i,e.value))},C=(n,t)=>{const i=f(t);i&&(o.onProgress(n,i,e.value),i.status="uploading",i.percentage=Math.round(n.percent))},g=(n,t)=>{const i=f(t);i&&(i.status="success",i.response=n,o.onSuccess(n,i,e.value),o.onChange(i,e.value))},E=n=>{fe(n.uid)&&(n.uid=J());const t={name:n.name,percentage:0,status:"ready",size:n.size,raw:n,uid:n.uid};if(o.listType==="picture-card"||o.listType==="picture")try{t.url=URL.createObjectURL(n)}catch(i){Be(re,i.message),o.onError(i,t,e.value)}e.value=[...e.value,t],o.onChange(t,e.value)},$=async n=>{const t=n instanceof File?f(n):n;t||Q(re,"file to be removed not found");const i=a=>{u(a);const c=e.value;c.splice(c.indexOf(a),1),o.onRemove(a,c),ie(a)};o.beforeRemove?await o.beforeRemove(t,e.value)!==!1&&i(t):i(t)};function p(){e.value.filter(({status:n})=>n==="ready").forEach(({raw:n})=>{var t;return n&&((t=r.value)==null?void 0:t.upload(n))})}return ee(()=>o.listType,n=>{n!=="picture-card"&&n!=="picture"||(e.value=e.value.map(t=>{const{raw:i,url:a}=t;if(!a&&i)try{t.url=URL.createObjectURL(i)}catch(c){o.onError(c,t,e.value)}return t}))}),ee(e,n=>{for(const t of n)t.uid||(t.uid=J()),t.status||(t.status="success")},{immediate:!0,deep:!0}),{uploadFiles:e,abort:u,clearFiles:d,handleError:v,handleProgress:C,handleStart:E,handleSuccess:g,handleRemove:$,submit:p,revokeFileObjectURL:ie}},ht=U({name:"ElUpload"}),kt=U({...ht,props:Je,setup(o,{expose:r}){const e=o,f=H(),u=X(),{abort:d,submit:v,clearFiles:C,uploadFiles:g,handleStart:E,handleError:$,handleRemove:p,handleSuccess:n,handleProgress:t,revokeFileObjectURL:i}=bt(e,u),a=G(()=>e.listType==="picture-card"),c=G(()=>({...e,fileList:g.value,onStart:E,onProgress:t,onSuccess:n,onError:$,onRemove:p}));return je(()=>{g.value.forEach(i)}),Ne(pe,{accept:qe(e,"accept")}),r({abort:d,submit:v,clearFiles:C,handleStart:E,handleRemove:p}),(l,_)=>(b(),w("div",null,[s(a)&&l.showFileList?(b(),S(ne,{key:0,disabled:s(f),"list-type":l.listType,files:s(g),"handle-preview":l.onPreview,onRemove:s(p)},te({append:P(()=>[F(le,se({ref_key:"uploadRef",ref:u},s(c)),{default:P(()=>[l.$slots.trigger?R(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?R(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:P(({file:L})=>[R(l.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):h("v-if",!0),!s(a)||s(a)&&!l.showFileList?(b(),S(le,se({key:1,ref_key:"uploadRef",ref:u},s(c)),{default:P(()=>[l.$slots.trigger?R(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?R(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)):h("v-if",!0),l.$slots.trigger?R(l.$slots,"default",{key:2}):h("v-if",!0),R(l.$slots,"tip"),!s(a)&&l.showFileList?(b(),S(ne,{key:3,disabled:s(f),"list-type":l.listType,files:s(g),"handle-preview":l.onPreview,onRemove:s(p)},te({_:2},[l.$slots.file?{name:"default",fn:P(({file:L})=>[R(l.$slots,"file",{file:L})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):h("v-if",!0)]))}});var Et=M(kt,[["__file","upload.vue"]]);const wt=Ae(Et);export{wt as E};
